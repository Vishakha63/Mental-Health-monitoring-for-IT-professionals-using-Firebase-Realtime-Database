<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>FireBase Realtime project</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  </head>
  <body>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <br><br>
        <div class ="container">
            <div class="row">
                <div class="col-3">
                    <input type = "text" class="form-control" id= "searchinput" , placeholder = "Search with severity-Mental_Health">
                </div>
                <div class="col-1">
                    <button class = "btn btn-primary" id="buttonForSearch">Search</button>
                </div>
                    
                <div class="col-1">
                    <button class = "btn btn-primary" id="buttonForFirst20records">View First 20 records</button>
                </div>

                <div class="col-1">
                    <button class = "btn btn-primary" id="buttonForLast20records">View Last 20 records</button>
                </div>

                <div class="col-1">
                    <button class = "btn btn-primary" id="buttonForAllRecords">View all the records</button>
                </div>

                <div class="col-2">
                    <input type = "text" class="form-control" id= "searchinput_param" , placeholder = "Enter the attribute">
                </div>

                <div class="col-1">
                    <input type = "text" class="form-control" id= "startAt_param" , placeholder = "Start">
                </div>

                <div class="col-1">
                    <input type = "text" class="form-control" id= "EndAt_param" , placeholder = "End">
                </div>

                <div class="col-1">
                    <button class = "btn btn-primary" id="buttonForSearchParameter">Search with StartAt/EndAt</button>
                </div>
                
                <div class="col-2">
                    <br><br>
                    <button class = "btn btn-primary" id="buttonForSearchParameter_1">Search with StartAfter_EndAfter</button>
                </div>
                
                <div class="col-2">
                    <br><br>
                    <button class = "btn btn-primary" id="buttonForMultipleColumns">Display records with Poor Mental Health and High Stress Level</button>
                </div>

                <div class="col-2">
                    <br><br>
                    <button class = "btn btn-primary" id="ButtonQuery1">Display records based on Sleep_Hours (>8) and Screen_Time_Hours (>12)</button>
                </div>

                <div class="col-2">
                    <br><br>
                    <button class = "btn btn-primary" id="ButtonQuery2">Display record based with maximum Physical_Activity_Hours and low Stress_Level</button>
                </div>

                <div class="col-2">
                    <br><br>
                    <button class = "btn btn-primary" id="ButtonAsc">Ascending Order-Social_Media_Usage_Hours</button>
                </div>

                <div class="col-2">
                    <br><br>
                    <button class = "btn btn-primary" id="ButtonDesc">Descending Order-Social_Media_Usage_Hours</button>
                </div>

                


            </div>

        </div>
        <br><br>
        <table class ="table table-success table-striped">
            <thead>
                <th>User_ID</th>
                <th>Age</th>
                <th>Gender</th>
                <th>Technology_Usage_Hours</th>
                <th>Social_Media_Usage_Hours</th>
                <th>Gaming_Hours</th>
                <th>Screen_Time_Hours</th>
                <th>Mental_Health_Status</th>
                <th>Stress_Level</th>
                <th>Sleep_Hours</th>
                <th>Physical_Activity_Hours</th>
                <th>Support_Systems_Access</th>
                <th>Work_Environment_Impact</th>
                <th>Online_Support_Usage</th>
            </thead>
            <tbody id = "tbody1"></tbody>
        </table>
        <script type="module">

            // Importing the functions from the SDKs
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-analytics.js";
            
          
            // Our web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
              apiKey: "AIzaSyCdnJOAYR118pNTBJETavSE1tT39hMYecI",
              authDomain: "final244project.firebaseapp.com", 
              databaseURL: "https://final244project-default-rtdb.firebaseio.com",
              projectId: "final244project",
              storageBucket: "final244project.appspot.com",
              messagingSenderId: "79226875048",
              appId: "1:79226875048:web:0d613c7d65f12e02f7a69d",
              measurementId: "G-RS9G5WQJEN"
            };
          
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);
            import {getDatabase, ref, child, get, set, update, remove,onValue, query, limitToFirst, limitToLast, startAt, startAfter,orderByChild, endBefore, endAt, equalTo, onChildAdded} from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js"
    
            const db = getDatabase();

            //Getting all data in a proper table format
            let EmployeeSetList = [];
            let tbody = document.getElementById('tbody1');

            // Will need employee list
            
            const RetrieveAllDataOnce  = ()=>{
                //Applying query function and putting the reference in the query function. The query will also take the address from the location from where the data will come. Mentioning the type of query as well.
                const dbRef = ref(db);
                
                get(child(dbRef,'EmployeeSet')).then((snapshot)=>{
                //get(query1).then((snapshot)=>{
                // To avoid duplicates, clearing the list again.
                    EmployeeSetList = [];
                    //console.log("Snapshot is:",snapshot);
                // with the help of forEachfunction will add the data to the list.
                    snapshot.forEach(employee =>{
                        EmployeeSetList.push(employee.val())
                    });
                    AddingAllRecords();
                })
                

            }
                

            //Function for Realtime Data without refreshing
            const SelectDisplayRealTimeData = () =>{
                const dbRef = ref(db,'EmployeeSet');
                onValue(dbRef,(snapshot)=>{
                    // To avoid duplicates, clearing the list again.
                    EmployeeSetList = [];
                    //console.log("Snapshot is:",snapshot);
                // with the help of forEachfunction will add the data to the list.
                    snapshot.forEach(employee =>{
                        EmployeeSetList.push(employee.val())
                        //console.log("check",employee,employee.val())
                    });
                    AddingAllRecords();
                })

            }
            //Function for adding a single record
            const AddingSingleRecordToTable = (USER_ID,Age,Gender,Technology_Usage_Hours,Social_Media_Usage_Hours,Gaming_Hours,Screen_Time_Hours,Mental_Health_Status,Stress_Level,Sleep_Hours,Physical_Activity_Hours,Support_Systems_Access,Work_Environment_Impact,Online_Support_Usage)=>{
                let trow = document.createElement('tr');
                var td1 = document.createElement('td');
                var td2 = document.createElement('td');
                var td3 = document.createElement('td');
                var td4 = document.createElement('td');
                var td5 = document.createElement('td');
                var td6 = document.createElement('td');
                var td7 = document.createElement('td');
                var td8 = document.createElement('td');
                var td9 = document.createElement('td');
                var td10 = document.createElement('td');
                var td11 = document.createElement('td');
                var td12 = document.createElement('td');
                var td13 = document.createElement('td');
                var td14 = document.createElement('td');
                td1.innerHTML = USER_ID;
                td2.innerHTML = Age;
                td3.innerHTML = Gender;
                td4.innerHTML = Technology_Usage_Hours;
                td5.innerHTML = Social_Media_Usage_Hours;
                td6.innerHTML = Gaming_Hours;
                td7.innerHTML = Screen_Time_Hours;
                td8.innerHTML = Mental_Health_Status;
                td9.innerHTML = Stress_Level;
                td10.innerHTML = Sleep_Hours;
                td11.innerHTML = Physical_Activity_Hours;
                td12.innerHTML = Support_Systems_Access;
                td13.innerHTML = Work_Environment_Impact;
                td14.innerHTML = Online_Support_Usage;
                trow.append(td1,td2,td3,td4,td5,td6,td7,td8,td9,td10,td11,td12,td13,td14);
                tbody.append(trow);


            }

            let rowsfiltered = [];
            let DataList = [];
            let bar_search = document.getElementById('searchinput');
            let bar_search_param = document.getElementById('searchinput_param');
            let StartAt_ret = document.getElementById('startAt_param');
            let EndAt_ret = document.getElementById('EndAt_param');

            
            // function to filter out the records based on the Severity of Mental_Health_Status entered in the search bar
            const RecordFilteration_MentalHealthStatus=()=>{
                //Emptying the tbody to avoid duplicates.Now matter how many times the function is being called.When the function will run it won't duplicate the data
                let retrievalserachbar = bar_search.value.trim();
                const query1 = query(ref(db, 'EmployeeSet'), orderByChild("Mental_Health_Status"), equalTo(retrievalserachbar))
                get(query1).then((snapshot)=>{
                // To avoid duplicates, clearing the list again.
                    EmployeeSetList = [];
                    //console.log("Snapshot is:",snapshot);
                // with the help of forEachfunction will add the data to the list.
                    snapshot.forEach(employee =>{
                        EmployeeSetList.push(employee.val())
                    });
                    AddingAllRecords();
                })
                }

                //Function to filter out the first 20 records from the start
                const RecordFilteration_FirstRecords=()=>{
                //Emptying the tbody to avoid duplicates.Now matter how many times the function is being called.When the function will run it won't duplicate the data
                alert("Successfully fetched the first 20 records!!!");
                const query1 = query(ref(db, 'EmployeeSet'), limitToFirst(20));
                get(query1).then((snapshot)=>{
                // To avoid duplicates, clearing the list again.
                    EmployeeSetList = [];
                    //console.log("Snapshot is:",snapshot);
                // with the help of forEachfunction will add the data to the list.
                    snapshot.forEach(employee =>{
                        EmployeeSetList.push(employee.val())
                    });
                    AddingAllRecords();
                })
                }

                //Function to filter out the last 20 records from the end
                const RecordFilteration_LastRecords=()=>{
                //Emptying the tbody to avoid duplicates.Now matter how many times the function is being called.When the function will run it won't duplicate the data
                alert("Successfully fetched the last 20 records!!!");
                const query1 = query(ref(db, 'EmployeeSet'), limitToLast(20));
                get(query1).then((snapshot)=>{
                // To avoid duplicates, clearing the list again.
                    EmployeeSetList = [];
                    //console.log("Snapshot is:",snapshot);
                // with the help of forEachfunction will add the data to the list.
                    snapshot.forEach(employee =>{
                        EmployeeSetList.push(employee.val())
                    });
                    AddingAllRecords();
                })
                }

                //function to filter records based on orderByChild(),startAt(), endAt()
                const RecordFilteration_WithParameter=()=>{
                //Emptying the tbody to avoid duplicates.Now matter how many times the function is being called.When the function will run it won't duplicate the data
                let retrievalsearchbar_param = bar_search_param.value.trim();
                let startAt_Value = StartAt_ret.value.trim();
                let endAt_Value = EndAt_ret.value.trim();
                console.log('Details are: ',retrievalsearchbar_param,startAt_Value,endAt_Value);
                
                const query1 = query(ref(db, 'EmployeeSet'), orderByChild(retrievalsearchbar_param), startAt(parseInt(startAt_Value)), endAt(parseInt(endAt_Value)));
                
                get(query1).then((snapshot)=>{
                // To avoid duplicates, clearing the list again.
                    EmployeeSetList = [];
                    //console.log("Snapshot is:",snapshot);
                // with the help of forEachfunction will add the data to the list.
                    snapshot.forEach(employee =>{
                        EmployeeSetList.push(employee.val())
                    });
                    AddingAllRecords();
                })
                }

                //function to filter records based on orderByChild(),startAfter(), endBefore()
                const RecordFilteration_WithParameter_StartAfter_EndBefore=()=>{
                //Emptying the tbody to avoid duplicates.Now matter how many times the function is being called.When the function will run it won't duplicate the data
                let retrievalsearchbar_param = bar_search_param.value.trim();
                let startAt_Value = StartAt_ret.value.trim();
                let endAt_Value = EndAt_ret.value.trim();
                console.log('Details are: ',retrievalsearchbar_param,startAt_Value,endAt_Value);
                const query1 = query(ref(db, 'EmployeeSet'), orderByChild(retrievalsearchbar_param), startAfter(parseInt(startAt_Value)), endBefore(parseInt(endAt_Value)));
                
                get(query1).then((snapshot)=>{
                // To avoid duplicates, clearing the list again.
                    EmployeeSetList = [];
                    //console.log("Snapshot is:",snapshot);
                // with the help of forEachfunction will add the data to the list.
                    snapshot.forEach(employee =>{
                        EmployeeSetList.push(employee.val())
                    });
                    AddingAllRecords();
                })
                }

                //function to filter the records based on Poor Mental_Health_Status and High Stress Level
                const RecordFilteration_combinedAttributes=()=>{
                //Emptying the tbody to avoid duplicates.Now matter how many times the function is being called.When the function will run it won't duplicate the data
                
                const query1 = query(ref(db, 'EmployeeSet'), orderByChild("Mental_Health_Status"), equalTo("Poor"))
                get(query1).then((snapshot)=>{
                // To avoid duplicates, clearing the list again.
                    EmployeeSetList = [];
                //creating an array to hold the filtered data for Mental Health Status and Stress Level
                    DataList =[];

                    //console.log("Snapshot is:",snapshot);
                // with the help of forEachfunction will add the data to the list.
                    snapshot.forEach(employee =>{
                        const FilteredInfo = employee.val();
                        if(FilteredInfo.Stress_Level === "High")
                    {
                        DataList.push(FilteredInfo);
                    }
                    });
                    if(DataList.length > 0){
                        EmployeeSetList = DataList;
                        AddingAllRecords();

                    }
                    else
                        alert.log("No records present!");
                    
                })
                }
                
                //function to filter records based on Sleep_Hours and Screen_Time_Hours
                const RecordFilteration_SleepHours_ScreenTimeHours=()=>{
                //Emptying the tbody to avoid duplicates.Now matter how many times the function is being called.When the function will run it won't duplicate the data
                
                const query1 = query(ref(db, 'EmployeeSet'))
                get(query1).then((snapshot)=>{
                // To avoid duplicates, clearing the list again.
                    EmployeeSetList = [];
                //creating an array to hold the filtered data for Mental Health Status and Stress Level
                    DataList =[];

                    //console.log("Snapshot is:",snapshot);
                // with the help of forEachfunction will add the data to the list.
                    snapshot.forEach(employee =>{
                        const FilteredInfo = employee.val();
                        if(FilteredInfo.Sleep_Hours > 8 && FilteredInfo.Screen_Time_Hours > 12)
                    {
                        DataList.push(FilteredInfo);
                    }
                    });
                    if(DataList.length > 0){
                        EmployeeSetList = DataList;
                        AddingAllRecords();

                    }
                    else
                        alert.log("No records present!");
                    
                })
                }
                
                //function to filter record of Maximum Physical_Activity_Hours and Stress_Level = Low
                const RecordFilteration_MaxPhysicalActivity_LowStressLevel=()=>{
                //Emptying the tbody to avoid duplicates.Now matter how many times the function is being called.When the function will run it won't duplicate the data
                
                //const query1 = query(ref(db, 'EmployeeSet'), orderByChild("Physical_Activity_Hours"), limitToLast(1))
                const query1 = query(ref(db, 'EmployeeSet'), orderByChild("Physical_Activity_Hours"), limitToLast(1))
                get(query1).then((snapshot)=>{
                // To avoid duplicates, clearing the list again.
                    EmployeeSetList = [];
                //creating an array to hold the filtered data for Mental Health Status and Stress Level
                    DataList =[];

                    //console.log("Snapshot is:",snapshot);
                // with the help of forEachfunction will add the data to the list.
                    snapshot.forEach(employee =>{
                        const FilteredInfo = employee.val();
                        if(FilteredInfo.Stress_Level === "Low")
                    {
                        DataList.push(FilteredInfo);
                    }
                    });
                    if(DataList.length > 0){
                        EmployeeSetList = DataList;
                        AddingAllRecords();

                    }
                    else
                        alert.log("No records present!");
                    
                })
                }

                //function to filter records in the ascending order
                const AscendingOrderDisplay=()=>{
                //Emptying the tbody to avoid duplicates.Now matter how many times the function is being called.When the function will run it won't duplicate the data
                
                const query1 = query(ref(db, 'EmployeeSet'), orderByChild('Social_Media_Usage_Hours'));
                
                get(query1).then((snapshot)=>{
                // To avoid duplicates, clearing the list again.
                    EmployeeSetList = [];
                    //console.log("Snapshot is:",snapshot);
                // with the help of forEachfunction will add the data to the list.
                    snapshot.forEach(employee =>{
                        EmployeeSetList.push(employee.val())
                    });
                    AddingAllRecords();
                })
                }


                //function to filter records in the descending order
                const DescendingOrderDisplay=()=>{
                //Emptying the tbody to avoid duplicates.Now matter how many times the function is being called.When the function will run it won't duplicate the data
                
                const query1 = query(ref(db, 'EmployeeSet'), orderByChild('Social_Media_Usage_Hours'));
                
                get(query1).then((snapshot)=>{
                // To avoid duplicates, clearing the list again.
                    EmployeeSetList = [];
                    //console.log("Snapshot is:",snapshot);
                // with the help of forEachfunction will add the data to the list.
                    snapshot.forEach(employee =>{
                        EmployeeSetList.push(employee.val())
                    });
                    AddingAllRecords_reverse();
                })
                }

                //Function to view all the real-time records
                const ViewAllRecords_ButtonClick=()=>{
                //Emptying the tbody to avoid duplicates.Now matter how many times the function is being called.When the function will run it won't duplicate the data
                SelectDisplayRealTimeData();
                }

                

            
            // Below four functions/events are used to display the relevant entered enteries in the two search boxes and once they are cleared all the realtime records should be displayed , clearing the filtered data
            // If there is no value in the search

            const SearchFieldEmpty = ()=>{
                //Emptying the tbody to avoid duplicates.Now matter how many times the function is being called.When the function will run it won't duplicate the data
                
                //Checking the condition
                if (bar_search.value.length < 1)
                    
                    SelectDisplayRealTimeData();
            }

            const Search_EnterPresent_EqualsTo = event =>{
                //Emptying the tbody to avoid duplicates.Now matter how many times the function is being called.When the function will run it won't duplicate the data
                
                //Checking the condition
                if (event.keyCode === 13)
                    RecordFilteration_MentalHealthStatus();
            }


            const SearchFieldEmpty_Param = ()=>{
                //Emptying the tbody to avoid duplicates.Now matter how many times the function is being called.When the function will run it won't duplicate the data
                
                //Checking the condition
                if (bar_search_param.value.length < 1){
                //if (bar_search_param.length < 1 && StartAt_ret.length < 1 && EndAt_ret.length < 1)
                    
                    StartAt_ret.value = "";
                    EndAt_ret.value = "";
                    SelectDisplayRealTimeData();
                }
            }

            const Search_EnterPresent_EqualsTo_Param = event =>{
                //Emptying the tbody to avoid duplicates.Now matter how many times the function is being called.When the function will run it won't duplicate the data
                
                //Checking the condition
                if (event.keyCode === 13)
                    RecordFilteration_WithParameter();
            }



            //Function for adding all records
            const AddingAllRecords=()=>{
                //EmployeeSetList = [];
                //Emptying the tbody to avoid duplicates.Now matter how many times the function is being called.When the function will run it won't duplicate the data
                tbody.innerHTML ="";
                EmployeeSetList.forEach(employee =>{
                    AddingSingleRecordToTable(employee.USER_ID,employee.Age,employee.Gender,employee.Technology_Usage_Hours,employee.Social_Media_Usage_Hours,employee.Gaming_Hours,employee.Screen_Time_Hours,employee.Mental_Health_Status,employee.Stress_Level,employee.Sleep_Hours,employee.Physical_Activity_Hours,employee.Support_Systems_Access,employee.Work_Environment_Impact,employee.Online_Support_Usage);
                    
                })

            }

            // Writing function to handle records to display records in the descending order through the javascript reverse() 
            const AddingAllRecords_reverse=()=>{
                EmployeeSetList.reverse();
                //Emptying the tbody to avoid duplicates.Now matter how many times the function is being called.When the function will run it won't duplicate the data
                tbody.innerHTML ="";
                EmployeeSetList.forEach(employee =>{
                    AddingSingleRecordToTable(employee.USER_ID,employee.Age,employee.Gender,employee.Technology_Usage_Hours,employee.Social_Media_Usage_Hours,employee.Gaming_Hours,employee.Screen_Time_Hours,employee.Mental_Health_Status,employee.Stress_Level,employee.Sleep_Hours,employee.Physical_Activity_Hours,employee.Support_Systems_Access,employee.Work_Environment_Impact,employee.Online_Support_Usage);
                    
                })
            }


            //Using Event listeners to load the event of the window
            //window.addEventListener('load',RetrieveAllDataOnce);
            window.addEventListener('load',SelectDisplayRealTimeData); 
            buttonForSearch.addEventListener('click', RecordFilteration_MentalHealthStatus);
            buttonForSearchParameter.addEventListener('click', RecordFilteration_WithParameter);
            buttonForSearchParameter_1.addEventListener('click', RecordFilteration_WithParameter_StartAfter_EndBefore);
            buttonForMultipleColumns.addEventListener('click', RecordFilteration_combinedAttributes);
            bar_search.addEventListener('input' , SearchFieldEmpty);
            bar_search.addEventListener('keypress' , Search_EnterPresent_EqualsTo);
            bar_search_param.addEventListener('input' , SearchFieldEmpty_Param);
            bar_search_param.addEventListener('keypress' , Search_EnterPresent_EqualsTo_Param);
            buttonForFirst20records.addEventListener('click',RecordFilteration_FirstRecords);
            buttonForLast20records.addEventListener('click',RecordFilteration_LastRecords);
            buttonForAllRecords.addEventListener('click',ViewAllRecords_ButtonClick);
            ButtonQuery1.addEventListener('click',RecordFilteration_SleepHours_ScreenTimeHours);
            ButtonQuery2.addEventListener('click',RecordFilteration_MaxPhysicalActivity_LowStressLevel);
            ButtonAsc.addEventListener('click',AscendingOrderDisplay);
            ButtonDesc.addEventListener('click',DescendingOrderDisplay);
        </script>
    </body>
    </html>


            
